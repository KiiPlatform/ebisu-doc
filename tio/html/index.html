<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>tio: tio</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">tio
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">tio </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>With <code>tio</code> and Kii Interaction Framework, you can quickly implement IoT devices which supports following functionalities.</p>
<ul>
<li>Read data from sensors and upload data to cloud periodically.</li>
<li>Receive remote control command from cloud and process it in your IoT device application.</li>
</ul>
<p><code>tio</code> consists of following modules.</p>
<ul>
<li><code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code></li>
</ul>
<p>Responsible for watching remote control command and propagate the command to IoT device application.</p>
<p>Once the module has been started, The loop inside the module keeps watching command arrival from the cloud.</p>
<ul>
<li><code><a class="el" href="structtio__updater__t.html" title="Stores data/ callbacks used by tio_updater. ">tio_updater_t</a></code></li>
</ul>
<p>Responsible for upload data read from sensors equipped to IoT devices.</p>
<p>Once the module has been started, The loop inside the module keeps asking for update by sensors periodically with the specified interval.</p>
<p>You can choose to run both <code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code> and <code><a class="el" href="structtio__updater__t.html" title="Stores data/ callbacks used by tio_updater. ">tio_updater_t</a></code> or either one.</p>
<h1>Use <code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code></h1>
<h2>Callback functions</h2>
<p>Application developer needs to prepare following callback functions.</p>
<h3>Task callbacks</h3>
<p><code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code> needs executing task asynchronously since it keeps waiting for commands sent to MQTT topic.</p>
<p><code>tio</code> needs abstraction with callbacks since the way of dispatch async tasks varies in different environments.</p>
<h4>Task creation</h4>
<p>Task create callback function signature is following.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> kii_task_code_t</div><div class="line">(*KII_CB_TASK_CREATE)</div><div class="line">    (<span class="keyword">const</span> <span class="keywordtype">char</span>* name,</div><div class="line">     KII_TASK_ENTRY entry,</div><div class="line">     <span class="keywordtype">void</span>* param);</div></div><!-- fragment --><p>Typical implementation with <code>pthread</code>:</p>
<div class="fragment"><div class="line">kii_task_code_t task_create_cb</div><div class="line">    (<span class="keyword">const</span> <span class="keywordtype">char</span>* name,</div><div class="line">     KII_TASK_ENTRY entry,</div><div class="line">     <span class="keywordtype">void</span>* param)</div><div class="line">{</div><div class="line">    pthread_t pthid;</div><div class="line">    <span class="keywordtype">int</span> ret = pthread_create(&amp;pthid, NULL, entry, param);</div><div class="line">    <span class="keywordflow">if</span>(ret == 0)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> KII_TASKC_OK;</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">return</span> KII_TASKC_FAIL;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h4>Task continue callback</h4>
<p>Task continue callback is used to determine whether to continue or exit task from the loop.</p>
<p>Task continue callback signature:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> kii_bool_t</div><div class="line">(*KII_CB_TASK_CONTINUE)</div><div class="line">    (<span class="keywordtype">void</span>* task_info,</div><div class="line">    <span class="keywordtype">void</span>* userdata);</div></div><!-- fragment --><p>Implementation in example app:</p>
<div class="fragment"><div class="line"><a class="code" href="tio_8h.html#ab308d3aa09bdc42afa0175ca19f8faaa">tio_bool_t</a> _handler_continue(<span class="keywordtype">void</span>* task_info, <span class="keywordtype">void</span>* userdata) {</div><div class="line">    <span class="keywordflow">if</span> (term_flag == <span class="keyword">true</span>) {</div><div class="line">        <span class="keywordflow">return</span> KII_FALSE;</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        <span class="keywordflow">return</span> KII_TRUE;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p><code>term_flag</code> is a variable determines whether to continue. Example app set it true when received <code>SIGINT</code> generated by Ctrl-C.</p>
<p>Note that we use <code>atomic_bool</code> type introduced in C11 since <code>term_flag</code> is referenced from signal handler, main thread and handler task thread (<code>_handler_continue()</code> is executed in handler task thread.)</p>
<h3>Task exit callback</h3>
<p>Task exit callback is called when task continue callback returns <code>KII_FALSE</code> or unrecoverable error occurs.</p>
<p>In this callback, you may need to free memories used for the handler task and other necessary steps when exiting task.</p>
<p>In the example app, we don't give allocated memory to <code>tio_handler</code> and <code>pthread</code> doesn't requires special treatment when exit loop, just set flag that indicate task has been exited safely.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> _handler_exit(<span class="keywordtype">void</span>* task_info, <span class="keywordtype">void</span>* userdata) {</div><div class="line">    printf(<span class="stringliteral">&quot;_handler_exit called\n&quot;</span>);</div><div class="line">    handler_terminated = <span class="keyword">true</span>;</div><div class="line">}</div></div><!-- fragment --><p><code>handler_terminated</code> is a variable indicates that resources allocated by handler is now all freed.</p>
<p>Details of memory management when exiting handler task, please refer to API reference of <code><a class="el" href="tio_8h.html#aa35750481e4c75949ae204a3886087a0" title="Callback called right before exit of tio_handler task. ">tio_handler_set_cb_task_exit()</a></code>.</p>
<p>We use <code>atomic_bool</code> here since the flag is referenced in main thread as well before exiting the process. (<code>_handler_exit()</code> is executed in handler task thread.)</p>
<h4>Delay callback</h4>
<p>In some situation program needs to wait for specified period of time to avoid the loop runs too fast or making too many requests to servers, etc.</p>
<p><code>tio</code> needs abstraction with callbacks since the way varies in different environments.</p>
<p>Delay callback function signature is following.</p>
<div class="fragment"><div class="line">typedef void</div><div class="line">(*KII_CB_DELAY_MS)</div><div class="line">    (unsigned int msec);</div></div><!-- fragment --><p>Typical implementation with <code>usleep</code> provided by <code>libc</code>:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> delay_ms_cb(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> msec)</div><div class="line">{</div><div class="line">    usleep(msec * 1000);</div><div class="line">}</div></div><!-- fragment --><h3>Socket callbacks.</h3>
<p><code>tio</code> provides abstraction of socket related functions.</p>
<p>Socket callback functions signature:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> khc_sock_code_t</div><div class="line">    (*KHC_CB_SOCK_CONNECT)</div><div class="line">    (<span class="keywordtype">void</span>* sock_ctx, <span class="keyword">const</span> <span class="keywordtype">char</span>* host, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> port);</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> khc_sock_code_t</div><div class="line">    (*KHC_CB_SOCK_SEND)</div><div class="line">    (<span class="keywordtype">void</span>* sock_ctx, <span class="keyword">const</span> <span class="keywordtype">char</span>* buffer, <span class="keywordtype">size_t</span> length);</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> khc_sock_code_t</div><div class="line">    (*KHC_CB_SOCK_RECV)</div><div class="line">    (<span class="keywordtype">void</span>* sock_ctx, <span class="keywordtype">char</span>* buffer, <span class="keywordtype">size_t</span> length_to_read,</div><div class="line">     <span class="keywordtype">size_t</span>* out_actual_length);</div><div class="line"></div><div class="line"><span class="keyword">typedef</span> khc_sock_code_t</div><div class="line">    (*KHC_CB_SOCK_CLOSE)(<span class="keywordtype">void</span>* sock_ctx);</div></div><!-- fragment --><p>You can see implementation with OpenSSL at <a href="linux-sample/sock_cb_linux.c">linux-sample</a></p>
<p><code>sock_ctx</code> argument is arbitrary data context which application can use. Application should pass the pointer of the data when calling <code><a class="el" href="tio_8h.html#ab86bbeef79079f4f23d753204d1cc235" title="Set socket connect callback used for HTTP(S) ">tio_handler_set_cb_sock_connect_http()</a></code>, <code><a class="el" href="tio_8h.html#aceb819b83d47d32e5f18a35172901050" title="Set socket send callback used for HTTP(S) ">tio_handler_set_cb_sock_send_http()</a></code>, <code><a class="el" href="tio_8h.html#a52039aa1414cd7820fa714fffc123f68" title="Set socket recv callback used for HTTP(S) ">tio_handler_set_cb_sock_recv_http()</a></code>, <code><a class="el" href="tio_8h.html#ad916c3d2a4dbb1ea16b61096aa021e43" title="Set socket close callback used for HTTP(S) ">tio_handler_set_cb_sock_close_http()</a></code>, <code><a class="el" href="tio_8h.html#af8990de68fc0f16880fa5698f084ef7c" title="Set socket connect callback used for MQTT(S) ">tio_handler_set_cb_sock_connect_mqtt()</a></code>, <code><a class="el" href="tio_8h.html#a3ddcee03aa130615b6ed5b5b5ffb8f29" title="Set socket send callback used for MQTT(S) ">tio_handler_set_cb_sock_send_mqtt()</a></code>, <code><a class="el" href="tio_8h.html#ab2ca2fe4902d2dec88487b7ba0cd8462" title="Set socket recv callback used for MQTT(S) ">tio_handler_set_cb_sock_recv_mqtt()</a></code>, <code><a class="el" href="tio_8h.html#acc92c10f507bf7011bffed282dbbecc9" title="Set socket close callback used for MQTT(S) ">tio_handler_set_cb_sock_close_mqtt()</a></code> methods.</p>
<p>Note that, <code>tio_handler</code> uses MQTT(s) to receive remote control commands and uses HTTP(s) to send the result of command execution.</p>
<p>Application can choose to pass different implementations of socket functions or same one. If you choose to pass same pointer of the function, Please also check <a href="#asynchronous-task-management">Asynchronous task management</a> section as well.</p>
<p>For both MQTT and HTTP, using them over secure connection is highly recommended. Our cloud supports non-secure connection for now. However, we may terminate supports of insecure connections in the future.</p>
<h4>Notes about socket implementation used for MQTT.</h4>
<p>Underlying socket implementation used for MQTT must be blocking mode and its recv/ send timeout must be shared with <code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code>.</p>
<p>We use socket timeout to estimate elapsed time since we sent last MQTT messages to send MQTT <code>PINGREQ</code> message periodically.</p>
<p>MQTT keep alive interval must be larger than recv/ send timeout. Twice as large as recv/ send timeout works fine but recommend few minutes to avoid congestion.</p>
<div class="fragment"><div class="line"><a class="code" href="tio_8h.html#a10a17b6e74dbbec58cd4092febb5d31f">tio_handler_set_mqtt_to_sock_recv</a>(handler, 15);</div><div class="line"><a class="code" href="tio_8h.html#a1080cf664e0cfa75a8fa39d93af40b0d">tio_handler_set_mqtt_to_sock_send</a>(handler, 15);</div><div class="line"><a class="code" href="tio_8h.html#a5f1e28a31ad4976fc142b6b9853fafa4">tio_handler_set_keep_alive_interval</a>(handler, 300);</div></div><!-- fragment --><h3>Action callback</h3>
<p>Action callback is called when the IoT device receives remote control command. You can implement IoT device specific control in the callback such as turn on/ off devices or changes level of actuators, etc.</p>
<p>Action callback signature:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <a class="code" href="tio_8h.html#ab308d3aa09bdc42afa0175ca19f8faaa">tio_bool_t</a> (*<a class="code" href="tio_8h.html#aca7f0c90cee5560884d58e8c5db51dca">TIO_CB_ACTION</a>)(</div><div class="line">    <a class="code" href="structtio__action__t.html">tio_action_t</a>* action,</div><div class="line">    <a class="code" href="structtio__action__err__t.html">tio_action_err_t</a>* err,</div><div class="line">    <span class="keywordtype">void</span>* userdata);</div></div><!-- fragment --><ul>
<li><code><a class="el" href="structtio__action__t.html#a412290b7cbd2cd3838f66420ab1ba187" title="Name of the alias. You need to use alias_length field to determine the length. It might not be null t...">tio_action_t.alias</a></code> is a string represents the alias of the trait which represents set of capabilities equipped.</li>
</ul>
<p>eg.) "AirConditioner", "LevelMonitor", etc.</p>
<ul>
<li><code><a class="el" href="structtio__action__t.html#a74dfdccea29e4ea983cb1aaf3f9cebd3" title="Name of the action. You need to use action_name_length field to determine the length. It might not be null terminated. ">tio_action_t.action_name</a></code> is a string represents the name of action.</li>
</ul>
<p>eg.) "setPresetTemperature", "executeMonitering", etc.</p>
<ul>
<li><code><a class="el" href="structtio__action__t.html#a069ab662c25522130cfae04320c69cff" title="Value of the action. ">tio_action_t.action_value</a></code> is a subject of the action.</li>
</ul>
<p>eg.) If the <code>action_name</code> is "setPresetTemperature", <code>action_value.type</code> might be a <code>long_value</code> and it's value is 26, 18, etc.</p>
<p>When the execution is failed, you can set the message in <code>err</code> argument and returns false. The result of execution and error message is stored in the cloud.</p>
<p><code>user_data</code> argument is a context object pointer given to <code><a class="el" href="tio_8h.html#a08af97b447ad0910c8b3b0ecbd17eda4" title="Start tio_handler task. ">tio_handler_start()</a></code> method.</p>
<p>Alias, action name, action value and its type is defined by the feature called <code>Trait</code>.</p>
<p>For more details about Trait, please refer to the <a href="http://docs.kii.com/en/guides/thingifsdk/">document</a>.</p>
<h2>Set-up <code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code> instance</h2>
<p>Here's the set-up code extracted from example app. The full code can be checked <a href="linux-sample/example.c">handler_init() in example.c</a></p>
<div class="fragment"><div class="line"><a class="code" href="tio_8h.html#aafb081be82a20ab3084d228ffdd004c0">tio_handler_init</a>(handler);</div><div class="line"></div><div class="line"><a class="code" href="tio_8h.html#aeb2ab7fd4cac1058134ce033ded303a4">tio_handler_set_app</a>(handler, KII_APP_ID, KII_APP_HOST);</div><div class="line"></div><div class="line"><a class="code" href="tio_8h.html#a466947dad26d88e5dfc80ddd3aa193c7">tio_handler_set_cb_task_create</a>(handler, task_create_cb_impl);</div><div class="line"><a class="code" href="tio_8h.html#a9723c521f8c3c5a7ccab463dabb8dcb2">tio_handler_set_cb_delay_ms</a>(handler, delay_ms_cb_impl);</div><div class="line"></div><div class="line"><a class="code" href="tio_8h.html#ab86bbeef79079f4f23d753204d1cc235">tio_handler_set_cb_sock_connect_http</a>(handler, sock_cb_connect, http_ssl_ctx);</div><div class="line"><a class="code" href="tio_8h.html#aceb819b83d47d32e5f18a35172901050">tio_handler_set_cb_sock_send_http</a>(handler, sock_cb_send, http_ssl_ctx);</div><div class="line"><a class="code" href="tio_8h.html#a52039aa1414cd7820fa714fffc123f68">tio_handler_set_cb_sock_recv_http</a>(handler, sock_cb_recv, http_ssl_ctx);</div><div class="line"><a class="code" href="tio_8h.html#ad916c3d2a4dbb1ea16b61096aa021e43">tio_handler_set_cb_sock_close_http</a>(handler, sock_cb_close, http_ssl_ctx);</div><div class="line"></div><div class="line"><a class="code" href="tio_8h.html#af8990de68fc0f16880fa5698f084ef7c">tio_handler_set_cb_sock_connect_mqtt</a>(handler, sock_cb_connect, mqtt_ssl_ctx);</div><div class="line"><a class="code" href="tio_8h.html#a3ddcee03aa130615b6ed5b5b5ffb8f29">tio_handler_set_cb_sock_send_mqtt</a>(handler, sock_cb_send, mqtt_ssl_ctx);</div><div class="line"><a class="code" href="tio_8h.html#ab2ca2fe4902d2dec88487b7ba0cd8462">tio_handler_set_cb_sock_recv_mqtt</a>(handler, sock_cb_recv, mqtt_ssl_ctx);</div><div class="line"><a class="code" href="tio_8h.html#acc92c10f507bf7011bffed282dbbecc9">tio_handler_set_cb_sock_close_mqtt</a>(handler, sock_cb_close, mqtt_ssl_ctx);</div><div class="line"></div><div class="line"><a class="code" href="tio_8h.html#a10a17b6e74dbbec58cd4092febb5d31f">tio_handler_set_mqtt_to_sock_recv</a>(handler, TO_RECV_SEC);</div><div class="line"><a class="code" href="tio_8h.html#a1080cf664e0cfa75a8fa39d93af40b0d">tio_handler_set_mqtt_to_sock_send</a>(handler, TO_SEND_SEC);</div><div class="line"></div><div class="line"><a class="code" href="tio_8h.html#a5c5c3a6234a32f20ccd58cec87ed22ab">tio_handler_set_http_buff</a>(handler, http_buffer, http_buffer_size);</div><div class="line"><a class="code" href="tio_8h.html#a75286f6e487e65690f23fb43ed4a3d01">tio_handler_set_mqtt_buff</a>(handler, mqtt_buffer, mqtt_buffer_size);</div><div class="line"></div><div class="line"><a class="code" href="tio_8h.html#a5f1e28a31ad4976fc142b6b9853fafa4">tio_handler_set_keep_alive_interval</a>(handler, HANDLER_KEEP_ALIVE_SEC);</div><div class="line"></div><div class="line"><a class="code" href="tio_8h.html#a251def6301bf4d05b17b78ebf691e0bc">tio_handler_set_json_parser_resource</a>(handler, resource);</div><div class="line"></div><div class="line"><a class="code" href="tio_8h.html#a264b6b0e9ec750b298b65781477004af">tio_handler_set_cb_task_continue</a>(handler, _handler_continue, NULL);</div><div class="line"><a class="code" href="tio_8h.html#aa35750481e4c75949ae204a3886087a0">tio_handler_set_cb_task_exit</a>(handler, _handler_exit, NULL);</div></div><!-- fragment --><p>Here's anatomy of set-up calls.</p>
<h3><code>tio_handler_init</code> call</h3>
<p>This function must be called prior to any other functions of <code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code>.</p>
<h3><code>tio_handler_set_app</code> call</h3>
<p>Set the Kii application information.</p>
<p>In the example, <code>KII_APP_ID</code> and <code>KII_APP_HOST</code> is defined as Macro. Those are used to identify work space in the cloud and the value is determined when you Kii Cloud App has been created. To create your Kii Cloud App, Sign-up to <a href="https://developer.kii.com">Developer console</a>.</p>
<h3>Set-up callbacks</h3>
<h4>Task callbacks.</h4>
<p>Set callback function pointers.</p>
<div class="fragment"><div class="line"><a class="code" href="tio_8h.html#a466947dad26d88e5dfc80ddd3aa193c7">tio_handler_set_cb_task_create</a>(handler, task_create_cb_impl);</div><div class="line"><a class="code" href="tio_8h.html#a9723c521f8c3c5a7ccab463dabb8dcb2">tio_handler_set_cb_delay_ms</a>(handler, delay_ms_cb_impl);</div></div><!-- fragment --><h3>Socket callbacks.</h3>
<p>Set callback function pointers and context data pointers. If you application allocates memory/ resources for context data, application is responsible to free those memory/ resources.</p>
<p>Different context objects named <code>http_ssl_ctx</code> and <code>mqtt_ssl_ctx</code> is used since the connection and it's life-cycle is different between them.</p>
<div class="fragment"><div class="line"><a class="code" href="tio_8h.html#ab86bbeef79079f4f23d753204d1cc235">tio_handler_set_cb_sock_connect_http</a>(handler, sock_cb_connect, http_ssl_ctx);</div><div class="line"><a class="code" href="tio_8h.html#aceb819b83d47d32e5f18a35172901050">tio_handler_set_cb_sock_send_http</a>(handler, sock_cb_send, http_ssl_ctx);</div><div class="line"><a class="code" href="tio_8h.html#a52039aa1414cd7820fa714fffc123f68">tio_handler_set_cb_sock_recv_http</a>(handler, sock_cb_recv, http_ssl_ctx);</div><div class="line"><a class="code" href="tio_8h.html#ad916c3d2a4dbb1ea16b61096aa021e43">tio_handler_set_cb_sock_close_http</a>(handler, sock_cb_close, http_ssl_ctx);</div></div><!-- fragment --><div class="fragment"><div class="line"><a class="code" href="tio_8h.html#af8990de68fc0f16880fa5698f084ef7c">tio_handler_set_cb_sock_connect_mqtt</a>(handler, sock_cb_connect, mqtt_ssl_ctx);</div><div class="line"><a class="code" href="tio_8h.html#a3ddcee03aa130615b6ed5b5b5ffb8f29">tio_handler_set_cb_sock_send_mqtt</a>(handler, sock_cb_send, mqtt_ssl_ctx);</div><div class="line"><a class="code" href="tio_8h.html#ab2ca2fe4902d2dec88487b7ba0cd8462">tio_handler_set_cb_sock_recv_mqtt</a>(handler, sock_cb_recv, mqtt_ssl_ctx);</div><div class="line"><a class="code" href="tio_8h.html#acc92c10f507bf7011bffed282dbbecc9">tio_handler_set_cb_sock_close_mqtt</a>(handler, sock_cb_close, mqtt_ssl_ctx);</div></div><!-- fragment --><h3>Set-up buffers</h3>
<p><code>tio_handler</code> needs memory buffer to store HTTP/ MQTT payloads.</p>
<p>In this example, assigned 4KB for HTTP payloads and 2KB for MQTT payloads. This size may covers most use-cases. However, If you're remote command definition is more and larger, you may need to allocate larger size.</p>
<p>Note that buffer for HTTP and MQTT must be isolated. Passing overlapping memory causes undefined behavior.</p>
<div class="fragment"><div class="line"><a class="code" href="tio_8h.html#a5c5c3a6234a32f20ccd58cec87ed22ab">tio_handler_set_http_buff</a>(handler, http_buffer, http_buffer_size);</div><div class="line"><a class="code" href="tio_8h.html#a75286f6e487e65690f23fb43ed4a3d01">tio_handler_set_mqtt_buff</a>(handler, mqtt_buffer, mqtt_buffer_size);</div></div><!-- fragment --><h3>Set-up MQTT socket timeout.</h3>
<p><code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code> needs socket timeout in seconds to send MQTT <code>PINGREQ</code> periodically.</p>
<p>Note that application must implement socket timeout in the socket callback implementation. You can see example <a href="./linux-sample/sys_cb_linux.c">here</a></p>
<div class="fragment"><div class="line"><a class="code" href="tio_8h.html#a10a17b6e74dbbec58cd4092febb5d31f">tio_handler_set_mqtt_to_sock_recv</a>(handler, TO_RECV_SEC);</div><div class="line"><a class="code" href="tio_8h.html#a1080cf664e0cfa75a8fa39d93af40b0d">tio_handler_set_mqtt_to_sock_send</a>(handler, TO_SEND_SEC);</div></div><!-- fragment --><h3>Set-up MQTT Keep Alive interval.</h3>
<p>In the example, <code>HANDLER_KEEP_ALIVE_SEC</code> is defined as Macro and value is 300 (in seconds).</p>
<p>MQTT have mechanism called <code>Keep Alive</code> detecting stale connection between the MQTT broker.</p>
<p><code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code> acts as MQTT clients and send <code>PINGREQ</code> to MQTT broker periodically with the specified interval. If <code>PINGRESP</code> from MQTT broker is not present, <code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code> would close the current connection and make fresh connection again.</p>
<p>If interval is set to 0, <code>Keep Alive</code> is turned off and no <code>PINGREQ</code> message is send to MQTT broker.</p>
<p>We highly recommend setting Keep Alive interval greater than 0 to detect disconnection. Recommended interval is few minutes since too small interval may cause network congestion and increases cloud cost.</p>
<p>MQTT keep alive interval must be larger than recv/ send timeout.</p>
<div class="fragment"><div class="line"><a class="code" href="tio_8h.html#a5f1e28a31ad4976fc142b6b9853fafa4">tio_handler_set_keep_alive_interval</a>(handler, HANDLER_KEEP_ALIVE_SEC);</div></div><!-- fragment --><h3>Set-up json parser resource</h3>
<p><code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code> uses <code>jkii</code> json parser library. <code>jkii</code> uses array of tokens to parse json string.</p>
<p>In this example, allocates 256 tokens statically.</p>
<div class="fragment"><div class="line"><a class="code" href="tio_8h.html#a251def6301bf4d05b17b78ebf691e0bc">tio_handler_set_json_parser_resource</a>(handler, resource);</div></div><!-- fragment --><p>Number of tokens to be used to parse json varies depending on how complex the target json string is. If you defined complex(i.e, a lot of fields or long arrays in the commands) control command, you would need to give larger number. Alternatively, you can use dynamic allocation for tokens by using following API:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <a class="code" href="tio_8h.html#af28ab86460e2c7b1ad11533f7875d41f">tio_handler_set_cb_json_parser_resource</a>(</div><div class="line">    <a class="code" href="structtio__handler__t.html">tio_handler_t</a>* handler,</div><div class="line">    JKII_CB_RESOURCE_ALLOC cb_alloc,</div><div class="line">    JKII_CB_RESOURCE_FREE cb_free);</div></div><!-- fragment --><p><code>cb_alloc</code> is called when the token is required and it's number is exactly same as numbers need to parse json string.</p>
<p><code>cb_free</code> is called when the parse has been done.</p>
<h2>Execute onboarding</h2>
<p>For the first time, Step called <code>onboarding</code> is required. In this step, Identifier of IoT device (thing ID) is generated and stored in cloud.</p>
<p>After the step, thing ID and access token is returned to IoT device. By using thing ID and access token, cloud can identify the device when the remote command is sent to the device with the thing ID or sensor data sent from the device with the token.</p>
<p>This step can be skipped once thing ID and access token is stored by the IoT devices.</p>
<p>Alternatively, you can execute this step outside of the IoT Device and pass thing ID and access token to IoT devices. Typical example is using Mobile apps to execute the onboarding step and passing thing ID and access token to the devices via BLE, etc.</p>
<div class="fragment"><div class="line"><a class="code" href="tio_8h.html#a1ae89481ebe95aa79ccca3b756d24f8b">tio_code_t</a> result = <a class="code" href="tio_8h.html#ac90c76e88fcd58ea5ca169b7bae0b6dc">tio_handler_onboard</a>(</div><div class="line">        &amp;handler,</div><div class="line">        vendorThingID,</div><div class="line">        password,</div><div class="line">        thingType,</div><div class="line">        firmWareVersion,</div><div class="line">        layoutPosition,</div><div class="line">        properties);</div><div class="line"><a class="code" href="tio_8h.html#a0c34d03833b19ecd902cc15462085eeb">tio_author_t</a>* author = <a class="code" href="tio_8h.html#a1dab03c0c0afa6d12251ef141eb06e0c">tio_handler_get_author</a>(&amp;handler);</div><div class="line"><span class="comment">/* thing ID and access token is stored in tio_author_t.</span></div><div class="line"><span class="comment">printf(&quot;thing ID: %s, access token %s\n&quot;, author-&gt;author_id, author-&gt;access_token);</span></div><div class="line"><span class="comment">*/</span></div></div><!-- fragment --><h2>Start module</h2>
<p>Now, it's ready to start <code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code> module.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> kii_author_t* author = <a class="code" href="tio_8h.html#a1dab03c0c0afa6d12251ef141eb06e0c">tio_handler_get_author</a>(&amp;handler);</div><div class="line"><a class="code" href="tio_8h.html#a08af97b447ad0910c8b3b0ecbd17eda4">tio_handler_start</a>(&amp;handler, author, tio_action_handler, NULL);</div></div><!-- fragment --><ul>
<li><code>author</code> consists of thing ID and access token obtained in the step of <a href="#execute-onboarding">Onboarding</a>.</li>
<li><code>tio_action_handler</code> is the callback function pointer explained in <a href="#action-callback">Action callback</a></li>
<li>last argument is context object pointer can be referenced in action callback. Passing NULL since we don't use context object in this example.</li>
</ul>
<p>This call results to execute asynchronous tasks created by <a href="#task-callbacks">Task callbacks</a>. The name of tasks initiated by this call is exported as macro <code>KII_TASK_NAME_MQTT</code> and <code>KII_TASK_NAME_PING_REQ</code> defined in <code>kii.h</code>.</p>
<h1>Use <code><a class="el" href="structtio__updater__t.html" title="Stores data/ callbacks used by tio_updater. ">tio_updater_t</a></code></h1>
<h2>Callback functions</h2>
<h3>Task callbacks, socket callbacks</h3>
<p>Similar to <code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code>.</p>
<p><code><a class="el" href="structtio__updater__t.html" title="Stores data/ callbacks used by tio_updater. ">tio_updater_t</a></code> only uses HTTP(s) and does not use MQTT(s).</p>
<h3>State read callbacks</h3>
<p><code><a class="el" href="structtio__updater__t.html" title="Stores data/ callbacks used by tio_updater. ">tio_updater_t</a></code> uploads the IoT device state such as sensor readings periodically with the specified interval.</p>
<p>When the specified interval elapsed, <code><a class="el" href="structtio__updater__t.html" title="Stores data/ callbacks used by tio_updater. ">tio_updater_t</a></code> execute callback function to read the latest state of the IoT device.</p>
<p>Application can implement the process reading values from sensors, etc.</p>
<h4>Size callback.</h4>
<p>Size callback is called to ask the size of new IoT device state. This callback is called before the read callback. If the returned size is 0, <code><a class="el" href="structtio__updater__t.html" title="Stores data/ callbacks used by tio_updater. ">tio_updater_t</a></code> skips updating device state.</p>
<p>Signature of size callback:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> size_t (*<a class="code" href="tio_8h.html#a6504896214118fbff1a5b2628e5ce2bc">TIO_CB_SIZE</a>)(<span class="keywordtype">void</span>* userdata);</div></div><!-- fragment --><p><code>userdata</code> is context object pointer given to <code><a class="el" href="tio_8h.html#a811629125262fd5495773f2c2320ba8d" title="Start tio_updater task. ">tio_updater_start()</a></code> argument.</p>
<h4>Read callback</h4>
<p>Read callback is used to read actual IoT device state. Callback is repeatedly called until it returns 0.</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> size_t (*<a class="code" href="tio_8h.html#a10e810d96e1b1e16f47b2d790f16b76c">TIO_CB_READ</a>)(</div><div class="line">    <span class="keywordtype">char</span> *buffer,</div><div class="line">    <span class="keywordtype">size_t</span> size,</div><div class="line">    <span class="keywordtype">void</span> *userdata);</div></div><!-- fragment --><ul>
<li><code>buffer</code> : Callback implementation writes the state data to this buffer.</li>
<li><code>size</code> : Requested size to be written to the buffer. If the returned value does not muches the requested size, <code>tio_updater</code> aborts the update process this time but the loop continues to run.</li>
<li><code>userdata</code> : Context object pointer passed to <code><a class="el" href="tio_8h.html#a811629125262fd5495773f2c2320ba8d" title="Start tio_updater task. ">tio_updater_start()</a></code> function.</li>
</ul>
<p>Expected format of the IoT device state is defined by <code>Trait</code>.</p>
<p>eg.)</p>
<div class="fragment"><div class="line">{</div><div class="line">    &quot;AirConditionerAlias&quot; : {</div><div class="line">        &quot;temperature&quot; : 29,</div><div class="line">        &quot;presetTemperature&quot; : 20</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><ul>
<li><code>AirConditionerAlias</code> is the name of the <code>Alias</code>.</li>
<li><code>temperature</code> is number type property defined in the <code>Trait</code>.</li>
<li><code>presetTemperature</code> is number type property defined in the <code>Trait</code>.</li>
</ul>
<p>For more details about format of the IoT device state and <code>Trait</code>, Please refer to (<a href="http://docs.kii.com/en/guides/thingifsdk/">http://docs.kii.com/en/guides/thingifsdk/</a>).</p>
<h2>Set-up <code><a class="el" href="structtio__updater__t.html" title="Stores data/ callbacks used by tio_updater. ">tio_updater_t</a></code> instance</h2>
<p>Here's the set-up code extracted from example app. The full code can be checked <a href="linux-sample/example.c">updater_init() in example.c</a></p>
<div class="fragment"><div class="line">tio_updater_init(updater);</div><div class="line"></div><div class="line">tio_updater_set_app(updater, KII_APP_ID, KII_APP_HOST);</div><div class="line"></div><div class="line">tio_updater_set_cb_task_create(updater, task_create_cb_impl);</div><div class="line">tio_updater_set_cb_delay_ms(updater, delay_ms_cb_impl);</div><div class="line"></div><div class="line">tio_updater_set_buff(updater, buffer, buffer_size);</div><div class="line"></div><div class="line">tio_updater_set_cb_sock_connect(updater, sock_cb_connect, sock_ssl_ctx);</div><div class="line">tio_updater_set_cb_sock_send(updater, sock_cb_send, sock_ssl_ctx);</div><div class="line">tio_updater_set_cb_sock_recv(updater, sock_cb_recv, sock_ssl_ctx);</div><div class="line">tio_updater_set_cb_sock_close(updater, sock_cb_close, sock_ssl_ctx);</div><div class="line"></div><div class="line">tio_updater_set_interval(updater, UPDATE_PERIOD_SEC);</div><div class="line"></div><div class="line">tio_updater_set_json_parser_resource(updater, resource);</div><div class="line"></div><div class="line">tio_updater_set_cb_task_continue(updater, _updater_continue, NULL);</div><div class="line">tio_updater_set_cb_task_exit(updater, _updater_exit, NULL);</div></div><!-- fragment --><ul>
<li><code><a class="el" href="tio_8h.html#aad0be7d9ce7261ac3b1cdf2b0a04168b" title="Set interval of updating state. ">tio_updater_set_interval()</a></code> specifies interval of uploading state in seconds.</li>
</ul>
<p>Other set-up process is similar to <code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code>.</p>
<h2>Execute onboarding</h2>
<p><code><a class="el" href="tio_8h.html#a9b237667de37baeade88d913459def78" title="Execute onboarding. ">tio_updater_onboard()</a></code> method is similar to <code><a class="el" href="tio_8h.html#ac90c76e88fcd58ea5ca169b7bae0b6dc" title="Execute onboarding. ">tio_handler_onboard()</a></code>.</p>
<p>If you use both <code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code> and <code><a class="el" href="structtio__updater__t.html" title="Stores data/ callbacks used by tio_updater. ">tio_updater_t</a></code> for an IoT device, you just need to execute onboarding process from either one. No need to execute onboarding for both method since the thing ID bonding process just need to be executed once.</p>
<p>After the onboarding has been done, you can get <code>tio_author_t</code> instance from either <code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code> or <code><a class="el" href="structtio__updater__t.html" title="Stores data/ callbacks used by tio_updater. ">tio_updater_t</a></code> and pass it to <code><a class="el" href="tio_8h.html#a08af97b447ad0910c8b3b0ecbd17eda4" title="Start tio_handler task. ">tio_handler_start()</a></code> or <code><a class="el" href="tio_8h.html#a811629125262fd5495773f2c2320ba8d" title="Start tio_updater task. ">tio_updater_start()</a></code> method.</p>
<h2>Start module</h2>
<p>Now, it's ready to start the updater module.</p>
<p>Here's code extracted from <a href="linux-sample/example.c">example app</a>.</p>
<div class="fragment"><div class="line"><a class="code" href="tio_8h.html#a811629125262fd5495773f2c2320ba8d">tio_updater_start</a>(</div><div class="line">    &amp;updater,</div><div class="line">    author,</div><div class="line">    updater_cb_state_size,</div><div class="line">    &amp;updater_file_ctx,</div><div class="line">    updater_cb_read,</div><div class="line">    &amp;updater_file_ctx);</div></div><!-- fragment --><ul>
<li><code>author</code> : Pointer to <code>tio_author_t</code> instance obtained from onboarded <code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code>.</li>
<li><code>updater_cb_state_size</code> : <a href="#size-callback">Size callback</a> function pointer.</li>
<li><code>updater_cb_read</code> : <a href="#read-callback">Read callback</a> function pointer.</li>
<li><code>updater_file_ctx</code> : Context object pointer referenced from both size callback/ read callback.</li>
</ul>
<h1>Asynchronous task management</h1>
<p><code>tio</code> execute multiple asynchronous tasks.</p>
<p>The name of tasks executed by <code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code> and <code><a class="el" href="structtio__updater__t.html" title="Stores data/ callbacks used by tio_updater. ">tio_updater_t</a></code> listed bellow.</p>
<h2>Tasks executed by <code><a class="el" href="structtio__handler__t.html" title="Stores data/ callbacks used by tio_handler. ">tio_handler_t</a></code>.</h2>
<ul>
<li><p class="startli"><code>KII_TASK_NAME_MQTT</code> is a name of the task defined at <code>kii.h</code> and passed as argument when <code><a class="el" href="tio_8h.html#a466947dad26d88e5dfc80ddd3aa193c7" title="Set callback creates task. ">tio_handler_set_cb_task_create()</a></code> is called to create task/ thread.</p>
<p class="startli">The task creation is requested once when the <code><a class="el" href="tio_8h.html#a08af97b447ad0910c8b3b0ecbd17eda4" title="Start tio_handler task. ">tio_handler_start()</a></code> method is invoked.</p>
<p class="startli">This task is responsible for getting MQTT endpoint information thru REST API and connect, receive message from MQTT and propagate message to app by the <code>TIO_CB_ACTION</code> callback, and send MQTT <code>PINGREQ</code> periodically.</p>
<p class="startli">This task executes callbacks set by following APIs.</p><ul>
<li><code><a class="el" href="tio_8h.html#ab86bbeef79079f4f23d753204d1cc235" title="Set socket connect callback used for HTTP(S) ">tio_handler_set_cb_sock_connect_http()</a></code></li>
<li><code><a class="el" href="tio_8h.html#aceb819b83d47d32e5f18a35172901050" title="Set socket send callback used for HTTP(S) ">tio_handler_set_cb_sock_send_http()</a></code></li>
<li><code><a class="el" href="tio_8h.html#a52039aa1414cd7820fa714fffc123f68" title="Set socket recv callback used for HTTP(S) ">tio_handler_set_cb_sock_recv_http()</a></code></li>
<li><code><a class="el" href="tio_8h.html#ad916c3d2a4dbb1ea16b61096aa021e43" title="Set socket close callback used for HTTP(S) ">tio_handler_set_cb_sock_close_http()</a></code></li>
<li><code><a class="el" href="tio_8h.html#af8990de68fc0f16880fa5698f084ef7c" title="Set socket connect callback used for MQTT(S) ">tio_handler_set_cb_sock_connect_mqtt()</a></code></li>
<li><code><a class="el" href="tio_8h.html#a3ddcee03aa130615b6ed5b5b5ffb8f29" title="Set socket send callback used for MQTT(S) ">tio_handler_set_cb_sock_send_mqtt()</a></code></li>
<li><code><a class="el" href="tio_8h.html#ab2ca2fe4902d2dec88487b7ba0cd8462" title="Set socket recv callback used for MQTT(S) ">tio_handler_set_cb_sock_recv_mqtt()</a></code></li>
<li><code><a class="el" href="tio_8h.html#acc92c10f507bf7011bffed282dbbecc9" title="Set socket close callback used for MQTT(S) ">tio_handler_set_cb_sock_close_mqtt()</a></code></li>
<li><code><a class="el" href="tio_8h.html#a9723c521f8c3c5a7ccab463dabb8dcb2" title="Callback asks to delay/ sleep task execution. ">tio_handler_set_cb_delay_ms()</a></code></li>
<li><code><a class="el" href="tio_8h.html#a08af97b447ad0910c8b3b0ecbd17eda4" title="Start tio_handler task. ">tio_handler_start()</a></code> (<code>TIO_CB_ACTION</code> callback)</li>
<li><code><a class="el" href="tio_8h.html#a444a539322f2441458b09aff53bbd055" title="Set callback propagates error. You can use it for debugging, etc or you can skip calling this API...">tio_handler_set_cb_err()</a></code> (Optional. In case set the error handler for debugging, etc.)</li>
<li><code><a class="el" href="tio_8h.html#af28ab86460e2c7b1ad11533f7875d41f" title="JSON parser resource callbacks. ">tio_handler_set_cb_json_parser_resource()</a></code> (Optional. In case dynamic memory allocation is chosen for parsing JSON.)</li>
</ul>
<p class="startli">This task uses buffers set by following APIs.</p><ul>
<li><code><a class="el" href="tio_8h.html#a5c5c3a6234a32f20ccd58cec87ed22ab" title="Set buffer used to construct/ parse HTTP request/ response. ">tio_handler_set_http_buff()</a></code></li>
<li><code><a class="el" href="tio_8h.html#a75286f6e487e65690f23fb43ed4a3d01" title="Set buffer used to parse MQTT message. ">tio_handler_set_mqtt_buff()</a></code></li>
</ul>
<p class="startli">Those two buffers must be separated and have no overlaps.</p>
</li>
</ul>
<h2>Tasks executed by <code><a class="el" href="structtio__updater__t.html" title="Stores data/ callbacks used by tio_updater. ">tio_updater_t</a></code>.</h2>
<ul>
<li><p class="startli"><code>TIO_TASK_NAME_UPDATE_STATE</code> is a name of the task defined at <code>kii.h</code> and passed as argument when <code><a class="el" href="tio_8h.html#a466947dad26d88e5dfc80ddd3aa193c7" title="Set callback creates task. ">tio_handler_set_cb_task_create()</a></code> is called to create task/ thread.</p>
<p class="startli">The task creation is requested once when the <code><a class="el" href="tio_8h.html#a811629125262fd5495773f2c2320ba8d" title="Start tio_updater task. ">tio_updater_start()</a></code> method is invoked.</p>
<p class="startli">This task is responsible for periodically updates the IoT device state with the specified interval.</p>
<p class="startli">This task executes callbacks set by following APIs.</p><ul>
<li><code><a class="el" href="tio_8h.html#a7618de7487856b06d5e703088a7902df" title="Set socket connect callback used for HTTP(S) ">tio_updater_set_cb_sock_connect()</a></code></li>
<li><code><a class="el" href="tio_8h.html#adc5793f8caa6e6678b169fa3c3d3cefa" title="Set socket send callback used for HTTP(S) ">tio_updater_set_cb_sock_send()</a></code></li>
<li><code><a class="el" href="tio_8h.html#a43c848291110b5c71748d7c94e5844bf" title="Set socket recv callback used for HTTP(S) ">tio_updater_set_cb_sock_recv()</a></code></li>
<li><code><a class="el" href="tio_8h.html#af300f3f0345ba2ffcda7d8d6fcb85463" title="Set socket close callback used for HTTP(S) ">tio_updater_set_cb_sock_close()</a></code></li>
<li><code><a class="el" href="tio_8h.html#af485efb1b941dae722bb4ca7305b1151" title="Callback asks to delay/ sleep task execution. ">tio_updater_set_cb_delay_ms()</a></code></li>
<li><code><a class="el" href="tio_8h.html#a811629125262fd5495773f2c2320ba8d" title="Start tio_updater task. ">tio_updater_start()</a></code> (<code>TIO_CB_SIZE</code>, <code>TIO_CB_READ</code> callbacks.)</li>
<li><code>tio_updater_set_cb_err()</code> (Optional. In case set the error handler for debugging, etc.)</li>
<li><code><a class="el" href="tio_8h.html#a9d7a37b31d9cd1758cdb2e447fce8936">tio_updater_set_cb_json_parser_resource()</a></code> (Optional. In case dynamic memory allocation is chosen for parsing JSON.)</li>
</ul>
<p class="startli">This task uses buffers set by following APIs.</p><ul>
<li><code><a class="el" href="tio_8h.html#ae3b4588ef6726f8970ef0848f2210332" title="Set buffer used to construct/ parse HTTP request/ response. ">tio_updater_set_buff()</a></code></li>
</ul>
</li>
</ul>
<h2>Avoiding race condition</h2>
<ul>
<li>Above 2 tasks <code>KII_TASK_NAME_MQTT</code> and <code>TIO_TASK_NAME_UPDATE_STATE</code> would be executed in parallel. Therefore, if the callback implementation shares the resource that need exclusive access, you need to implement access control mechanism.</li>
<li>You must prepare independent buffers which does not have overlaps. </li>
</ul>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Oct 16 2019 09:49:26 for tio by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
